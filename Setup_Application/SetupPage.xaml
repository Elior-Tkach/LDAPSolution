<UserControl x:Class="Setup_Application.SetupPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
    mc:Ignorable="d" d:DesignWidth="900" Height="554">
    <UserControl.Resources>
        <Style x:Key="HighlightableButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="LightGray"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="12"> <!-- Adjust the radius as you like -->
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="Tag" Value="Highlighted">
                    <Setter Property="Background" Value="LightBlue"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <!-- Remove duplicate DataTemplate with same key -->
        <DataTemplate x:Key="TreeViewHeaderTemplate">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="{Binding Name}" />
                <TextBlock Text=" " />
                <TextBlock Text="{Binding TypeLabel}" Foreground="Blue" FontWeight="Bold"/>
            </StackPanel>
        </DataTemplate>
        <HierarchicalDataTemplate x:Key="TreeViewHeaderHierarchicalTemplate" ItemsSource="{Binding Children}">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="{Binding Name}" />
                <TextBlock Text=" " />
                <TextBlock Text="{Binding TypeLabel}" Foreground="Blue" FontWeight="Bold"/>
            </StackPanel>
        </HierarchicalDataTemplate>
    </UserControl.Resources>
    <Canvas Margin="0,0,32,48">
        <Canvas.Background>
            <ImageBrush ImageSource="Accellix logo2.png" Stretch="UniformToFill"/>
        </Canvas.Background>
        <!-- All content from SetupPage.xaml except Window root -->
        <Button Content="Find User" Style="{StaticResource HighlightableButtonStyle}" Width="166" Canvas.Left="34" Canvas.Top="105" Click="FindUserBtn_Click" HorizontalAlignment="Left" VerticalAlignment="Top" Height="46" FontSize="20" Tag="Highlightable"/>
        <Button Content="Find Group" Style="{StaticResource HighlightableButtonStyle}" Width="160" Canvas.Left="214" Canvas.Top="104" Click="FindGroupBtn_Click" HorizontalAlignment="Left" VerticalAlignment="Top" Height="47" FontSize="20" Tag="Highlightable"/>
        <Button Content="Choose group or user from the tree" Style="{StaticResource HighlightableButtonStyle}" Width="340" Canvas.Left="34" Canvas.Top="163" Click="ChooseGroupFromListBtn_Click" HorizontalAlignment="Left" VerticalAlignment="Top" Height="47" FontSize="20" Tag="Highlightable"/>
        <RadioButton x:Name="OperatorRadio" Content="Operator" GroupName="Role" Visibility="Collapsed" Canvas.Left="574" Canvas.Top="175" HorizontalAlignment="Left" VerticalAlignment="Top" FontSize="18" />
        <RadioButton x:Name="AdminRadio" Content="Administrator" GroupName="Role" Visibility="Collapsed" Canvas.Left="680" Canvas.Top="175" HorizontalAlignment="Left" VerticalAlignment="Top" FontSize="18" />
        <TextBox x:Name="SelectedTextBox" Width="292" IsReadOnly="True" Canvas.Left="337" Canvas.Top="264" Visibility="Collapsed" FontSize="16" HorizontalAlignment="Left" VerticalAlignment="Center" Height="28" BorderThickness="0" Background="Transparent" />
        <Button Content="Save" x:Name="SaveBtn" Width="121" Canvas.Left="627" Visibility="Collapsed" Canvas.Top="217" Click="SaveBtn_Click" HorizontalAlignment="Left" VerticalAlignment="Top" Height="32" FontSize="20" RenderTransformOrigin="0.5,0.5" >
            <Button.RenderTransform>
                <TransformGroup>
                    <ScaleTransform/>
                    <SkewTransform/>
                    <RotateTransform Angle="0.4"/>
                    <TranslateTransform/>
                </TransformGroup>
            </Button.RenderTransform>
        </Button>
        <!-- Dynamic Controls -->
        <TextBlock x:Name="UserNamePromptTextBlock" Text="Enter user name:" Canvas.Left="115" Canvas.Top="236" Visibility="Collapsed" FontSize="18" Height="56" Width="329"/>
        <TextBox x:Name="UserNameInputTextBox" Width="292" Height="34" Canvas.Left="264" Canvas.Top="236" Visibility="Collapsed" HorizontalAlignment="Left" VerticalAlignment="Top"  KeyDown="UserNameInputTextBox_KeyDown" FontSize="17"/>
        <TextBlock x:Name="GroupNamePromptTextBlock" Text="Enter group name:" Canvas.Left="100" Canvas.Top="236" Visibility="Collapsed" FontSize="18" Height="56" Width="329" HorizontalAlignment="Left" VerticalAlignment="Top" />
        <TextBox x:Name="GroupNameInputTextBox" Width="291" Height="34" Canvas.Left="265" Canvas.Top="236" Visibility="Collapsed" HorizontalAlignment="Left" VerticalAlignment="Top"  KeyDown="GroupNameInputTextBox_KeyDown" FontSize="17" TextChanged="GroupNameInputTextBox_TextChanged"/>
        <ListBox x:Name="UserSelectListBox" Width="291" Height="183" Canvas.Left="265" Canvas.Top="275" Visibility="Collapsed" HorizontalAlignment="Left" VerticalAlignment="Top" FontSize="16"/>
        <Button Content="Show all users and groups with permission" Style="{StaticResource HighlightableButtonStyle}" Width="386" Canvas.Left="449" Canvas.Top="104" Click="ShowPermissionsBtn_Click" Height="40" FontSize="18" HorizontalAlignment="Left" VerticalAlignment="Top" Background="LightGreen"/>
        <ListBox x:Name="PermissionsListBox" Width="600" Height="200" Canvas.Left="96" Canvas.Top="230" Visibility="Collapsed" FontSize="16" HorizontalAlignment="Center" VerticalAlignment="Top"/>
        <Button x:Name="DeleteSelectedPermissionBtn" Content="Delete Selected" Width="120" Height="28" Canvas.Left="716" Canvas.Top="232"
        Visibility="Collapsed" Click="DeleteSelectedPermissionBtn_Click" FontSize="16" Background="Orange" HorizontalAlignment="Center" VerticalAlignment="Top"/>
        <Button x:Name="ClearAllPermissionsBtn" Content="Clear All" Width="120" Height="28" Canvas.Left="716" Canvas.Top="265"
        Visibility="Collapsed" Click="ClearAllPermissionsBtn_Click" FontSize="16" Background="Red" HorizontalAlignment="Center" VerticalAlignment="Top"/>
        <Button x:Name="ClosePermissionsBtn" Content="X" Width="28" Height="28" Canvas.Left="670" Canvas.Top="232"
        Visibility="Collapsed"  Click="ClosePermissionsBtn_Click" FontSize="16" Background="LightGray" Foreground="Red" HorizontalAlignment="Center" VerticalAlignment="Top"/>

        <TreeView x:Name="GroupTreeView"
                  ItemTemplate="{StaticResource TreeViewHeaderTemplate}"
                  Width="490"
                  Height="220"
                  Canvas.Left="77"
                  Canvas.Top="236"
                  Visibility="Collapsed"
                  FontSize="16"
                  HorizontalAlignment="Left"
                  VerticalAlignment="Top"/>
        <TextBlock x:Name="SuccessMessageTextBlock"
           Text=""
           Visibility="Collapsed"
           FontSize="18"
           Foreground="Green"
           Canvas.Left="593"
           Canvas.Top="253"
           FontWeight="Bold" HorizontalAlignment="Left" VerticalAlignment="Center">
            <TextBlock.Inlines>
                <Run Text="✔ " FontSize="20"/>
                <Run x:Name="SuccessMessageRun" Text="User/Group saved successfully"/>
            </TextBlock.Inlines>
        </TextBlock>
    </Canvas>
</UserControl>